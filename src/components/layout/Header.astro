---
import { menuLinks } from "@/site-config";
import Search from "../Search.astro";
import { Image } from "astro:assets";
import Avatar from "@/assets/avatar.png";
import { Icon } from "astro-icon/components";
import Tags from "../Tags.astro";
import SocialList from "../SocialList.astro";

const url = new URL(Astro.request.url);
---

<header
	class="group relative flex items-center justify-between sm:flex-col sm:items-start sm:gap-8"
	id="main-header"
>
	<div class="flex sm:flex-col">
		<a
			aria-current={url.pathname === "/" ? "page" : false}
			class="flex grayscale hover:filter-none sm:flex-col"
			href="/"
		>
			<Image
				src={Avatar}
				class="ml-3 w-12 sm:ml-0 sm:w-full"
				loading="eager"
				alt="Meissam Rasouli Logo"
				aria-label="Meissam Rasouli Logo"
				role="img"
			/>
			<div class="mt-2 flex flex-col sm:items-start">
				<span class="text-md font-bold"> وبلاگ میثم رسولی</span>
				<span class="text-xs"> یادداشتهای یک برنامه‌نویس </span>
			</div>
		</a>
	</div>
	<div class="flex items-start sm:flex-col sm:gap-8">
		<nav
			aria-label="Main menu"
			class="absolute inset-x-4 top-14 hidden flex-col items-start gap-y-4 bg-header bg-slate-200 px-6 py-4 text-link shadow group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:mt-1 sm:flex sm:items-start sm:bg-transparent sm:px-0 sm:py-0 sm:shadow-none"
			id="navigation-menu"
		>
			{
				menuLinks.map((link) => (
					<a
						aria-current={url.pathname === link.path ? "page" : false}
						class="py-0 underline-offset-2 sm:hover:underline"
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}
			<Search />
			<Tags />
			<SocialList />
		</nav>

		<div class="sm:flex sm:divide-y">
			<mobile-button>
				<button
					aria-expanded="false"
					aria-haspopup="menu"
					aria-label="Open main menu"
					class="group relative ms-4 mt-2 h-8 w-8 sm:invisible sm:hidden"
					id="toggle-navigation-menu"
					type="button"
				>
					<Icon aria-hidden="true" class="h-5 w-5" focusable="false" name="line-md:menu" />
				</button>
			</mobile-button>
		</div>
	</div>
</header>

<script>
	import { toggleClass } from "@/utils/domElement";

	class MobileNavBtn extends HTMLElement {
		#menuOpen: boolean = false;

		connectedCallback() {
			const headerEl = document.getElementById("main-header")!;
			const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");

			mobileButtonEl?.addEventListener("click", () => {
				if (headerEl) toggleClass(headerEl, "menu-open");
				this.#menuOpen = !this.#menuOpen;
				mobileButtonEl.setAttribute("aria-expanded", this.#menuOpen.toString());
			});
		}
	}

	customElements.define("mobile-button", MobileNavBtn);
</script>
